import{r as a,v as J,H as K,J as Q,K as G,j as s,M as A,N as I,w as U,x as L,O,C as X,T as D,S as q,y as V,F as Y}from"./index-CkHtwYmJ.js";import{g as _,u as $,c as ee}from"./auth-CWwGZ6HQ.js";import{A as Z}from"./Alert-CeTGSqaQ.js";import{T as f}from"./TextField-Nsebl5_n.js";import"./axios-BH6LnKjt.js";import"./index-Dq7h7Pqt.js";const se={entering:{transform:"none"},entered:{transform:"none"}},H=a.forwardRef(function(x,C){const l=J(),T={enter:l.transitions.duration.enteringScreen,exit:l.transitions.duration.leavingScreen},{addEndListener:u,appear:M=!0,children:w,easing:N,in:y,onEnter:P,onEntered:E,onEntering:m,onExit:c,onExited:R,onExiting:F,style:g,timeout:i=T,TransitionComponent:j=K,...W}=x,h=a.useRef(null),b=Q(h,G(w),C),d=e=>o=>{if(e){const p=h.current;o===void 0?e(p):e(p,o)}},v=d(m),k=d((e,o)=>{I(e);const p=A({style:g,timeout:i,easing:N},{mode:"enter"});e.style.webkitTransition=l.transitions.create("transform",p),e.style.transition=l.transitions.create("transform",p),P&&P(e,o)}),S=d(E),B=d(F),r=d(e=>{const o=A({style:g,timeout:i,easing:N},{mode:"exit"});e.style.webkitTransition=l.transitions.create("transform",o),e.style.transition=l.transitions.create("transform",o),c&&c(e)}),t=d(R),n=e=>{u&&u(h.current,e)};return s.jsx(j,{appear:M,in:y,nodeRef:h,onEnter:k,onEntered:S,onEntering:v,onExit:r,onExited:t,onExiting:B,addEndListener:n,timeout:i,...W,children:(e,{ownerState:o,...p})=>a.cloneElement(w,{style:{transform:"scale(0)",visibility:e==="exited"&&!y?"hidden":void 0,...se[e],...g,...w.props.style},ref:b,...p})})}),le=()=>{const z=J();U(z.breakpoints.up("md"));const[x,C]=a.useState(null),[l,T]=a.useState({address:"",phoneNumber:"",paymentMethod:""}),[u,M]=a.useState({}),[w,N]=a.useState(!0),[y,P]=a.useState(!1),[E,m]=a.useState({type:null,message:null}),[c,R]=a.useState({oldPassword:"",newPassword:""}),[F,g]=a.useState(""),[i,j]=a.useState({}),[W,h]=a.useState(!1),[b,d]=a.useState({type:null,message:null});a.useEffect(()=>{_().then(r=>{C(r),T({address:r.address||"",phoneNumber:r.phoneNumber||"",paymentMethod:r.paymentMethod||""})}).catch(r=>{var t,n;m({type:"error",message:((n=(t=r.response)==null?void 0:t.data)==null?void 0:n.message)||r.message})}).finally(()=>N(!1))},[]);const v=r=>{const{name:t,value:n}=r.target;T(e=>({...e,[t]:n})),n.trim()?M(e=>{const o={...e};return delete o[t],o}):M(e=>({...e,[t]:"Required"}))},k=async r=>{var t,n;if(r.preventDefault(),!Object.keys(u).length){P(!0),m({type:null,message:null});try{const e=await $(l);C(e),m({type:"success",message:"Profile updated"})}catch(e){m({type:"error",message:((n=(t=e.response)==null?void 0:t.data)==null?void 0:n.message)||e.message})}finally{P(!1)}}},S=r=>{const{name:t,value:n}=r.target;t==="confirm"?(g(n),j(e=>({...e,confirm:n===c.newPassword?"":"Passwords do not match"}))):(R(e=>({...e,[t]:n})),j(n?e=>{const o={...e};return delete o[t],o}:e=>({...e,[t]:"Required"})))},B=async r=>{var t,n;if(r.preventDefault(),!(i.oldPassword||i.newPassword||i.confirm)){h(!0),d({type:null,message:null});try{await ee(c),d({type:"success",message:"Password changed"}),R({oldPassword:"",newPassword:""}),g("")}catch(e){d({type:"error",message:((n=(t=e.response)==null?void 0:t.data)==null?void 0:n.message)||e.message})}finally{h(!1)}}};return w?s.jsx(L,{sx:{display:"flex",justifyContent:"center",mt:4},children:s.jsx(O,{})}):s.jsxs(X,{maxWidth:"sm",sx:{mt:4,mb:4},children:[s.jsx(D,{variant:"h4",gutterBottom:!0,children:"My Profile"}),E.type&&s.jsx(H,{in:!0,children:s.jsx(Z,{severity:E.type,sx:{mb:2},onClose:()=>m({type:null,message:null}),children:E.message})}),s.jsx(L,{component:"form",onSubmit:k,noValidate:!0,children:s.jsxs(q,{spacing:2,children:[s.jsx(f,{label:"Email",value:x==null?void 0:x.email,InputProps:{readOnly:!0},fullWidth:!0}),s.jsx(f,{label:"Address",name:"address",value:l.address,onChange:v,error:!!u.address,helperText:u.address,fullWidth:!0}),s.jsx(f,{label:"Phone Number",name:"phoneNumber",value:l.phoneNumber,onChange:v,error:!!u.phoneNumber,helperText:u.phoneNumber,fullWidth:!0}),s.jsx(f,{label:"Payment Method",name:"paymentMethod",value:l.paymentMethod,onChange:v,error:!!u.paymentMethod,helperText:u.paymentMethod,fullWidth:!0}),s.jsx(V,{type:"submit",variant:"contained",disabled:y,children:y?s.jsx(O,{size:24}):"Save Profile"})]})}),s.jsx(Y,{sx:{my:4}}),s.jsx(D,{variant:"h5",gutterBottom:!0,children:"Change Password"}),b.type&&s.jsx(H,{in:!0,children:s.jsx(Z,{severity:b.type,sx:{mb:2},onClose:()=>d({type:null,message:null}),children:b.message})}),s.jsx(L,{component:"form",onSubmit:B,noValidate:!0,children:s.jsxs(q,{spacing:2,children:[s.jsx(f,{label:"Old Password",name:"oldPassword",type:"password",value:c.oldPassword,onChange:S,error:!!i.oldPassword,helperText:i.oldPassword,fullWidth:!0}),s.jsx(f,{label:"New Password",name:"newPassword",type:"password",value:c.newPassword,onChange:S,error:!!i.newPassword,helperText:i.newPassword,fullWidth:!0}),s.jsx(f,{label:"Confirm New Password",name:"confirm",type:"password",value:F,onChange:S,error:!!i.confirm,helperText:i.confirm,fullWidth:!0}),s.jsx(V,{type:"submit",variant:"contained",disabled:W,children:W?s.jsx(O,{size:24}):"Change Password"})]})})]})};export{le as default};
