import{h as A,j as e,s as L,B as U,l as O,Z as T,a as Q,g as W,r as n,i as F,_ as V,k as H,e as q,T as c,v as G,x as h,$ as z,z as J,a0 as Z,F as $,a1 as _,y as E,L as I,a2 as K,q as X,t as Y,C as ee,D as se,R as re,E as te}from"./index-CkHtwYmJ.js";import{l as M,g as ae,s as oe}from"./drug-DrWeykhr.js";import{C as ne}from"./CardActions-CsGG2Wbr.js";import{S as ie}from"./SearchBar-DuABP8fW.js";import{A as ce}from"./Alert-Cgbj89Tf.js";import"./axios-BH6LnKjt.js";import"./index-Dq7h7Pqt.js";import"./TextField-Nsebl5_n.js";import"./Alert-CeTGSqaQ.js";const le=A(e.jsx("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})),de=L(U)(O(({theme:r})=>({display:"flex",marginLeft:`calc(${r.spacing(1)} * 0.5)`,marginRight:`calc(${r.spacing(1)} * 0.5)`,...r.palette.mode==="light"?{backgroundColor:r.palette.grey[100],color:r.palette.grey[700]}:{backgroundColor:r.palette.grey[700],color:r.palette.grey[100]},borderRadius:2,"&:hover, &:focus":{...r.palette.mode==="light"?{backgroundColor:r.palette.grey[200]}:{backgroundColor:r.palette.grey[600]}},"&:active":{boxShadow:r.shadows[0],...r.palette.mode==="light"?{backgroundColor:T(r.palette.grey[200],.12)}:{backgroundColor:T(r.palette.grey[600],.12)}}}))),ue=L(le)({width:24,height:16});function me(r){const{slots:i={},slotProps:p={},...t}=r,a=r;return e.jsx("li",{children:e.jsx(de,{focusRipple:!0,...t,ownerState:a,children:e.jsx(ue,{as:i.CollapsedIcon,ownerState:a,...p.collapsedIcon})})})}function he(r){return W("MuiBreadcrumbs",r)}const pe=Q("MuiBreadcrumbs",["root","ol","li","separator"]),fe=r=>{const{classes:i}=r;return q({root:["root"],li:["li"],ol:["ol"],separator:["separator"]},he,i)},xe=L(c,{name:"MuiBreadcrumbs",slot:"Root",overridesResolver:(r,i)=>[{[`& .${pe.li}`]:i.li},i.root]})({}),ge=L("ol",{name:"MuiBreadcrumbs",slot:"Ol"})({display:"flex",flexWrap:"wrap",alignItems:"center",padding:0,margin:0,listStyle:"none"}),be=L("li",{name:"MuiBreadcrumbs",slot:"Separator"})({display:"flex",userSelect:"none",marginLeft:8,marginRight:8});function ye(r,i,p,t){return r.reduce((a,o,f)=>(f<r.length-1?a=a.concat(o,e.jsx(be,{"aria-hidden":!0,className:i,ownerState:t,children:p},`separator-${f}`)):a.push(o),a),[])}const Se=n.forwardRef(function(i,p){const t=F({props:i,name:"MuiBreadcrumbs"}),{children:a,className:o,component:f="nav",slots:P={},slotProps:j={},expandText:m="Show path",itemsAfterCollapse:x=1,itemsBeforeCollapse:C=1,maxItems:w=8,separator:v="/",...N}=t,[y,R]=n.useState(!1),u={...t,component:f,expanded:y,expandText:m,itemsAfterCollapse:x,itemsBeforeCollapse:C,maxItems:w,separator:v},g=fe(u),B=V({elementType:P.CollapsedIcon,externalSlotProps:j.collapsedIcon,ownerState:u}),b=n.useRef(null),D=s=>{const l=()=>{R(!0);const d=b.current.querySelector("a[href],button,[tabindex]");d&&d.focus()};return C+x>=s.length?s:[...s.slice(0,C),e.jsx(me,{"aria-label":m,slots:{CollapsedIcon:P.CollapsedIcon},slotProps:{collapsedIcon:B},onClick:l},"ellipsis"),...s.slice(s.length-x,s.length)]},k=n.Children.toArray(a).filter(s=>n.isValidElement(s)).map((s,l)=>e.jsx("li",{className:g.li,children:s},`child-${l}`));return e.jsx(xe,{ref:p,component:f,color:"textSecondary",className:H(g.root,o),ownerState:u,...N,children:e.jsx(ge,{className:g.ol,ref:b,ownerState:u,children:ye(y||w&&k.length<=w?k:D(k),g.separator,v,u)})})}),je=({results:r,searchQuery:i,loading:p})=>{G();const t=r.slice(0,6),a=r.length>t.length;return p?e.jsx(h,{className:"py-8 text-center",children:e.jsx(c,{variant:"body1",children:"Searching medications..."})}):r.length===0?e.jsxs(h,{className:"py-8 text-center",children:[e.jsxs(c,{variant:"h6",className:"mb-2",children:['No medications found matching "',i,'"']}),e.jsx(c,{variant:"body1",color:"text.secondary",children:"Try adjusting your search terms or browse our categories."})]}):e.jsxs(h,{children:[e.jsxs(h,{className:"mb-6",children:[e.jsxs(c,{variant:"h5",className:"mb-2",children:["Found ",r.length,' medications matching "',i,'"']}),e.jsxs(c,{variant:"body1",color:"text.secondary",children:["Showing ",t.length," of ",r.length," results"]})]}),e.jsx(z,{container:!0,spacing:3,children:t.map(o=>e.jsx(z,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(J,{className:"h-full flex flex-col hover:shadow-lg transition-shadow",children:[e.jsxs(Z,{className:"flex-grow",children:[e.jsx(c,{variant:"h6",className:"font-bold mb-1",children:o.name}),e.jsx(c,{variant:"body2",color:"text.secondary",className:"mb-2",children:o.manufacturer}),e.jsx($,{className:"my-2"}),o.description&&e.jsx(c,{variant:"body2",className:"mb-3 text-sm",sx:{display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"},children:o.description}),e.jsx(h,{className:"mt-2",children:e.jsx(_,{label:o.prescriptionRequired?"Prescription required":"Over-the-counter",color:o.prescriptionRequired?"primary":"success",size:"small",variant:"outlined"})})]}),e.jsx(ne,{children:e.jsx(E,{component:I,to:`/drugs/${o.id}`,size:"small",color:"primary",children:"View Details"})})]})},o.id))}),a&&e.jsxs(h,{className:"mt-8 text-center p-6 bg-gray-100 rounded-lg",children:[e.jsxs(c,{variant:"h6",className:"mb-2",children:["Want to see all ",r.length," results?"]}),e.jsx(c,{variant:"body1",className:"mb-4",children:"Sign in or create an account to access our full medication catalog."}),e.jsxs(h,{className:"flex justify-center gap-3",children:[e.jsx(E,{variant:"contained",component:I,to:"/register",sx:{borderRadius:"50px",px:3,fontWeight:600,textTransform:"none"},children:"Create Account"}),e.jsx(E,{variant:"outlined",component:I,to:"/login",sx:{borderRadius:"50px",px:3,fontWeight:600,textTransform:"none"},children:"Sign In"})]})]})]})},Ie=()=>{const r=K(),i=X(),t=new URLSearchParams(r.search).get("q")||"",{token:a}=Y(),[o,f]=n.useState(t),[P,j]=n.useState([]),[m,x]=n.useState(!0),[C,w]=n.useState(!!t),[v,N]=n.useState(null),[y,R]=n.useState(new Set),u=n.useRef(!1),g=n.useRef(null),B=n.useCallback(async()=>{if(m)try{const s=a?await M():await ae();j(s)}catch(s){console.error("Failed to load drugs:",s),N("Failed to load medications. Please try again later.")}finally{x(!1)}},[m,a]);n.useEffect(()=>{g.current=B},[B]);const b=n.useCallback(async s=>{if(console.log("performSearch called with query:",s),console.log("performSearch deps:",{searchedQueriesSize:y.size,searchQuery:o,hasToken:!!a}),y.has(s.trim().toLowerCase())){console.log("Search skipped - query already searched");return}if(!u.current&&s.trim().toLowerCase()===o.trim().toLowerCase())console.log("NOT skipping initial search even though query matches searchQuery");else if(u.current&&s.trim().toLowerCase()===o.trim().toLowerCase()){console.log("Search skipped - query matches current query (not initial search)");return}if(!s.trim()){console.log("Empty query, calling fetchInitialDrugs"),g.current&&g.current();return}x(!0),w(!0),N(null);try{if(a){const l=await M(),d=D(s,l);j(d),d.length===0&&R(S=>new Set([...S,s.trim().toLowerCase()]))}else{const l=await oe(s);j(l),l.length===0&&R(d=>new Set([...d,s.trim().toLowerCase()]))}}catch(l){console.error("Error searching drugs:",l),N("Failed to search medications. Please try again later."),R(d=>new Set([...d,s.trim().toLowerCase()]))}finally{x(!1)}},[y,o,a]);n.useEffect(()=>{console.log("Main useEffect running with deps:",{initialQuery:t,hasToken:!!a,performSearchRef:typeof b}),console.log("Dependency array values:",JSON.stringify({initialQuery:t,tokenExists:!!a,performSearchIdentity:b.toString().substring(0,50)+"..."})),u.current=!1,t&&!u.current?(console.log("Running initial search with query:",t),b(t),u.current=!0):!t&&!u.current&&(console.log("No initial query, fetching initial drugs"),B(),u.current=!0)},[t,a,b]);const D=(s,l)=>{if(!s.trim())return l;const d=s.toLowerCase().trim();return l.filter(S=>S.name.toLowerCase().includes(d)||S.manufacturer&&S.manufacturer.toLowerCase().includes(d)||S.description&&S.description.toLowerCase().includes(d))},k=s=>{if(y.has(s.trim().toLowerCase())){f(s),j([]),x(!1),w(!0);const d=s?`/search?q=${encodeURIComponent(s)}`:"/search";i(d,{replace:!0});return}f(s);const l=s?`/search?q=${encodeURIComponent(s)}`:"/search";i(l,{replace:!0}),b(s)};return e.jsxs(ee,{sx:{py:4},children:[e.jsxs(Se,{"aria-label":"breadcrumb",className:"mb-4",children:[e.jsx(se,{component:I,to:"/",color:"inherit",children:"Home"}),e.jsx(c,{color:"text.primary",children:"Search Results"})]}),e.jsx(c,{variant:"h4",className:"mb-6",children:"Search Medications"}),e.jsxs(re,{elevation:3,className:"p-4 mb-8 rounded-lg",children:[e.jsx(c,{variant:"h6",className:"mb-3",children:"Find medications by name, manufacturer, or description"}),e.jsx(ie,{placeholder:"Search for medications...",onSearch:k,initialValue:o,fullWidth:!0})]}),m&&e.jsx(h,{className:"text-center py-8",children:e.jsx(te,{text:"Searching medications..."})}),v&&!m&&e.jsx(ce,{type:"error",message:v,isStatic:!0}),!m&&!v&&C&&e.jsxs(h,{children:[e.jsx($,{className:"mb-6"}),e.jsx(je,{results:P,searchQuery:o,loading:m})]}),!C&&!m&&e.jsxs(h,{className:"text-center py-10",children:[e.jsx(c,{variant:"h5",className:"mb-2",children:"Enter a search term to find medications"}),e.jsx(c,{variant:"body1",color:"text.secondary",children:"Search by medication name, manufacturer, or description"})]})]})};export{Ie as default};
